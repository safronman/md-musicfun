import { Callout } from "nextra/components"

# 15. Zod

## –¢–µ–æ—Ä–∏—è

`Zod` ‚Äî —ç—Ç–æ `TypeScript-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞` –¥–ª—è **–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö** –∏ **—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Ç–∏–ø–æ–≤**. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ
—Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏, –ø—Ä–æ–≤–µ—Ä—è—è –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–∏–ø—ã –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (`runtime`), –∞ —Ç–∞–∫–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç
`TypeScript-—Ç–∏–ø—ã` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

<Callout type={"info"} emoji={"üîó"}>
  –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤–∞–ª–∏–¥–∞—Ü–∏–∏ [Zod](https://zod.dev/basics):
</Callout>

**üî∑–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É [Zod](https://zod.dev) –∏ [@hookform/resolvers](https://www.npmjs.com/package/@hookform/resolvers):**

```bash filename="Terminal"
pnpm add zod @hookform/resolvers
```

**üî∑ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ `Zod`:**

**1. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

- –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω—É–∂–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä–æ–∫–∞, —á–∏—Å–ª–æ, email, –º–∞—Å—Å–∏–≤ –∏ —Ç.–¥.).
- –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å API, —Ñ–æ—Ä–º–∞–º–∏, –∑–∞–ø—Ä–æ—Å–∞–º–∏, –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

**2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç—å —Ç–∏–ø—ã TypeScript**

- –¢—ã –ø–∏—à–µ—à—å —Å—Ö–µ–º—É ‚Äî `TypeScript` —Å–∞–º –≤—ã–≤–æ–¥–∏—Ç —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞.
- –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä.

**3. –£–ø—Ä–æ—â–∞—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–¥–∞**

- –ï—Å–ª–∏ `z.infer<typeof schema>` –≤—ã–¥–∞–µ—Ç —Ç–∏–ø, –∑–Ω–∞—á–∏—Ç, –¥–∞–Ω–Ω—ã–µ —Ç–æ—á–Ω–æ –ø—Ä–æ—à–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Å –Ω–∏–º–∏ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å.

**üî∑–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?**

- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º (`React`, `Next.js`, `Vue` –∏ –¥—Ä.).
- –ü–∞—Ä—Å–∏–Ω–≥ API-–æ—Ç–≤–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `fetch-–∑–∞–ø—Ä–æ—Å–∞—Ö`).
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (`env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ`, `JSON-—Ñ–∞–π–ª—ã`).

**üî∑–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç Zod?**

- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –ª–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è TypeScript-–ø–æ–¥–¥–µ—Ä–∂–∫–∞.
- ‚úÖ –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å (–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã).

## –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞. –ï—Å–ª–∏ —Å–µ–π—á–∞—Å –º—ã –Ω–µ –≤–≤–µ–¥–µ–º –Ω–∏–∫–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–µ–º
–∫–Ω–æ–ø–∫—É `create playlist`, —Ç–æ —É–≤–∏–¥–∏–º —Å–µ—Ä–≤–µ—Ä–Ω—É—é –æ—à–∏–±–∫—É `"title must be longer than or equal to 1 characters;
Received value:"`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –±–µ–∫–µ–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–ª —Ç–∞–∫–æ–π –∫–µ–π—Å –∏ –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –Ω–∞–º —Å–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç —Å
–ø—É—Å—Ç—ã–º `title`. –ù–æ –∑–∞—á–µ–º –Ω–∞–º –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–æ–±—â–µ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å, –¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑—É–µ–º —ç—Ç—É –∑–∞–¥–∞—á—É –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ñ—Ä–æ–Ω—Ç–∞ –∏ —Ç–∞–∫–∏–º
–æ–±—Ä–∞–∑–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—É–¥–µ—Ç –±–µ—Å–ø–æ–∫–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä, –∞ —Å—Ä–∞–∑—É –∂–µ –≤—ã–≤–æ–¥–∏—Ç—å –æ—à–∏–±–∫—É

–ù–∞—Ç–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `React Hook Form` –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ñ–æ—Ä–º —Å –Ω–µ—Å–ª–æ–∂–Ω—ã–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è–º–∏ –∏ –Ω–µ–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª–µ–π.
–ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ –ø–æ–ª–µ–π —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è–º–∏, —Ç–æ –∫–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—á–∏—Ç–∞–µ–º—ã–º –∏ —Å–ª–æ–∂–Ω—ã–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

–£–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º –ø–æ–º–æ–≥–∞—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –æ–¥–Ω–æ–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —è–≤–ª—è–µ—Ç—Å—è [Zod](https://zod.dev/).
–û–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è `React Hook Form` —Å –ø–æ–º–æ—â—å—é [@hookform/resolvers](https://www.npmjs.com/package/@hookform/resolvers).

### 1. –û–ø—Ä–µ–¥–µ–ª–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—É—é —Å—Ö–µ–º—É

<Callout type={'info'} emoji={'üîó'}>

[–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã](https://zod.dev/basics?id=defining-a-schema)

</Callout>

- `features/playlists/model/playlists.schemas.ts`

```ts filename="playlists.schemas.ts"
export const createPlaylistSchema = z.object({
  title: z.string(),
  description: z.string(),
})
```

### 2. –î–æ–±–∞–≤–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é

<Callout type={'info'} emoji={'üîó'}>

[–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä–æ–∫](https://zod.dev/api#strings)

</Callout>

- `playlists.schemas.ts`

```ts filename="playlists.schemas.ts"
export const createPlaylistSchema = z.object({
  title: z.string().min(1).max(100),
  description: z.string().max(1000),
})
```

- `CreatePlaylistForm.tsx`

```tsx filename="CreatePlaylistForm.tsx" {2-3, 11, 13, 23, 27 }
/*...*/
import { type SubmitHandler, useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import s from "./CreatePlaylistForm.module.css"

export const CreatePlaylistForm = () => {
  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<CreatePlaylistArgs>({
    resolver: zodResolver(createPlaylistSchema),
  })

  /*...*/

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <h2>Create new playlist</h2>
      <div>
        <input {...register("title")} placeholder={"title"} />
        {errors.title && <span className={s.error}>{errors.title.message}</span>}
      </div>
      <div>
        <input {...register("description")} placeholder={"description"} />
        {errors.description && <span className={s.error}>{errors.description.message}</span>}
      </div>
      <button>create playlist</button>
    </form>
  )
}
```

- `CreatePlaylistForm.module.css`

```css filename="CreatePlaylistForm.module.css"
.error {
  color: red;
  font-weight: bold;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ñ–æ—Ä–º–∞ –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∞ –∏ –∑–∞—â–∏—â–µ–Ω–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ üöÄ

### 3. –ö–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –º–µ–Ω—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —É–∫–∞–∑–∞–Ω–∏—è –Ω—É–∂–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤—Ä—É—á–Ω—É—é:

<Callout type={'info'} emoji={'üîó'}>

[–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫](https://zod.dev/error-customization?id=the-error-param)

</Callout>

```ts filename="playlists.schemas.ts"
export const createPlaylistSchema = z.object({
  title: z
    .string()
    .min(1, "The title length must be more than 1 character")
    .max(100, "The title length must be less than 100 characters"),
  description: z.string().max(1000, "The description length must be less than 1000 characters."),
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥–∏—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ üöÄ

### 4. –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–∞

<Callout type={'info'} emoji={'üîó'}>

[–í—ã–≤–æ–¥ —Ç–∏–ø–æ–≤](https://zod.dev/basics?id=inferring-types)

</Callout>

–ß—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å —Ç–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã –≤—Ä—É—á–Ω—É—é, –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `z.infer`:

```ts filename="loginSchema.ts"
// ‚ùå
// export type CreatePlaylistArgs = {
//   title: string
//   description: string
// }

// ‚úÖ
export type CreatePlaylistArgs = z.infer<typeof createPlaylistSchema>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª–∏ —Ñ–æ—Ä–º—É –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–µ–ª–∏ —Ç–∏–ø üöÄ

## –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞

### Playlists

**–û–ø—Ä–µ–¥–µ–ª–∏–º —Å—Ö–µ–º—É –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤**

- `common/schemas/schemas.ts`

```ts filename="schemas.ts"
export const tagSchema = z.object({
  id: z.string(),
  name: z.string(),
})

export const userSchema = z.object({
  id: z.string(),
  name: z.string(),
})

export const coverSchema = z.object({
  type: z.literal(["original", "medium", "thumbnail"]),
  width: z.int().positive(),
  height: z.int().positive(),
  fileSize: z.int().positive(),
  url: z.url(),
})

export const imagesSchema = z.object({
  main: z.array(coverSchema),
})

export const currentUserReactionSchema = z.enum(CurrentUserReaction)
```

- `common/types/types.ts`

```ts filename="types.ts"
export type Tag = z.infer<typeof tagSchema>
export type User = z.infer<typeof userSchema>
export type Cover = z.infer<typeof coverSchema>
export type Images = z.infer<typeof imagesSchema>
export type CurrentUserReaction = z.infer<typeof currentUserReactionSchema>
```

- `common/enums/enums.ts`

```ts filename="enums.ts"
export const CurrentUserReaction = {
  Like: 1,
  Dislike: -1,
  None: 0,
} as const

// ‚ùå remove
// export type CurrentUserReaction = (typeof CurrentUserReaction)[keyof typeof CurrentUserReaction]
```

- `playlists.schemas.ts`

```ts filename="playlists.schemas.ts"
export const createPlaylistSchema = z.object({
  title: z
    .string()
    .min(1, "The title length must be more than 1 character")
    .max(100, "The title length must be less than 100 characters"),
  description: z.string().max(1000, "The description length must be less than 1000 characters."),
})

export const playlistMetaSchema = z.object({
  // page: z.int().positive(),
  page: z.string(),
  pageSize: z.int().positive(),
  totalCount: z.int().positive(),
  pagesCount: z.int().positive(),
})

export const playlistAttributesSchema = z.object({
  title: z.string(),
  description: z.string(),
  addedAt: z.iso.datetime(),
  updatedAt: z.iso.datetime(),
  order: z.int(),
  dislikesCount: z.int().nonnegative(),
  likesCount: z.int().nonnegative(),
  tags: z.array(tagSchema),
  images: imagesSchema,
  user: userSchema,
  currentUserReaction: currentUserReactionSchema,
})

export const playlistDataSchema = z.object({
  id: z.string(),
  type: z.literal("playlists"),
  attributes: playlistAttributesSchema,
})

export const playlistsResponseSchema = z.object({
  data: z.array(playlistDataSchema),
  meta: playlistMetaSchema,
})
```

- `playlistsApi.types.ts`

```ts filename="playlistsApi.types.ts"
export type PlaylistMeta = z.infer<typeof playlistMetaSchema>
export type PlaylistAttributes = z.infer<typeof playlistAttributesSchema>
export type PlaylistData = z.infer<typeof playlistDataSchema>
export type PlaylistsResponse = z.infer<typeof playlistsResponseSchema>

// Arguments
export type FetchPlaylistsArgs = {
  pageNumber?: number
  pageSize?: number
  search?: string
  sortBy?: "addedAt" | "likesCount"
  sortDirection?: "asc" | "desc"
  tagsIds?: string[]
  userId?: string
  trackId?: string
}

export type CreatePlaylistArgs = z.infer<typeof createPlaylistSchema>

export type UpdatePlaylistArgs = {
  title: string
  description: string
  tagIds: string[]
}
```

#### fetchPlaylists validation

<Callout type={"info"} emoji={"üîó"}>
  –ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ [2.7.0 –æ—Ç 16.04.2025](https://github.com/reduxjs/redux-toolkit/releases/tag/v2.7.0)
  RTK query –¥–æ–±–∞–≤–∏–ª–∏ `Standard Schema Validation`

- [queries](https://redux-toolkit.js.org/rtk-query/usage/queries#runtime-validation-using-schemas)
- [mutations](https://redux-toolkit.js.org/rtk-query/usage/mutations#runtime-validation-using-schemas)
- [responseSchema](https://redux-toolkit.js.org/rtk-query/api/createApi#responseschema) - –º–µ—Ç–æ–¥ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ö–µ–º—ã
- [Schema validation](https://redux-toolkit.js.org/rtk-query/api/createApi#schema-validation) - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Ç–æ–≥–æ,
  —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏

</Callout>

<Callout type={"warning"} emoji={"‚ùó"}>
  –ï—Å–ª–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `responseSchema`, —Ç–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –Ω–µ –Ω–∞–¥–æ, –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è
</Callout>

```ts filename="playlistsApi.ts" {5-9}
export const playlistsApi = baseApi.injectEndpoints({
  endpoints: (build) => ({
    fetchPlaylists: build.query({
      query: (params: FetchPlaylistsArgs) => ({ url: `playlists`, params }),
      responseSchema: playlistsResponseSchema,
      catchSchemaFailure: (err) => {
        errorToast("Zod error. Details in the console", err.issues)
        return { status: "CUSTOM_ERROR", error: "Schema validation failed" }
      },
      providesTags: ["Playlist"],
    }),
    /*...*/
  }),
})
```

–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º –æ—à–∏–±–∫—É, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.

```ts filename="playlistMetaSchema.ts" {2-3}
export const playlistMetaSchema = z.object({
  // page: z.int().check(z.positive()),
  page: z.string(),
  pageSize: z.int().check(z.positive()),
  totalCount: z.int().check(z.positive()),
  pagesCount: z.int().check(z.positive()),
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ü–ª–µ–π–ª–∏—Å—Ç—ã –Ω–µ –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ `zod` –≤–∞–ª–∏–¥–∞—Ü–∏–∏ üöÄ
- –û—à–∏–±–∫–∞ –≤—ã–≤–µ–¥–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω üöÄ
- –í –∫–æ–Ω—Å–æ–ª–∏ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ üöÄ

#### createPlaylist validation

–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–¥–µ–ª–∞–µ–º zod –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞

- `playlists.schemas.ts`

```ts filename="playlists.schemas.ts"
/*...*/
export const playlistCreateResponseSchema = z.object({
  data: playlistDataSchema,
})
```

```ts filename="playlistsApi.ts" {5-9}
export const playlistsApi = baseApi.injectEndpoints({
  endpoints: (build) => ({
    createPlaylist: build.mutation({
      query: (body: CreatePlaylistArgs) => ({ url: "playlists", method: "post", body }),
      responseSchema: playlistCreateResponseSchema,
      catchSchemaFailure: (err) => {
        errorToast("Zod error. Details in the console", err.issues)
        return { status: "CUSTOM_ERROR", error: "Schema validation failed" }
      },
      invalidatesTags: ["Playlist"],
    }),
    /*...*/
  }),
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¥–æ–ø—É—Å—Ç–∏—Ç–µ –æ—à–∏–±–∫—É –≤ `playlistCreateResponseSchema` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ—Ä–Ω–æ üöÄ

#### uploadPlaylistCover validation

–ß—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å `playlistApi`, —Ä–µ–∞–ª–∏–∑—É–µ–º –µ—â–µ `zod` –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±–ª–æ–∂–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞

```ts filename="playlistsApi.ts" {7-11}
export const playlistsApi = baseApi.injectEndpoints({
  endpoints: (build) => ({
    uploadPlaylistCover: build.mutation({
      query: ({ playlistId, file }: { playlistId: string; file: File }) => {
        /*...*/
      },
      responseSchema: imagesSchema,
      catchSchemaFailure: (err) => {
        errorToast("Zod error. Details in the console", err.issues)
        return { status: "CUSTOM_ERROR", error: "Schema validation failed" }
      },
      invalidatesTags: ["Playlist"],
    }),
    /*...*/
  }),
})
```

<Callout type={"warning"}>
  –ï—Å–ª–∏ –±–µ–∫–µ–Ω–¥ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `deletePlaylist`,
  `updatePlaylist` –∏ `deletePlaylistCover` –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å.
</Callout>

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–∫—Ä—ã–ª–∏ `zod` –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ üöÄ

### withZodCatch

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Ç–µ–ø–µ—Ä—å –Ω–∞–º –≤ –∫–∞–∂–¥–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ –≥–¥–µ –º—ã —Ö–æ—Ç–∏–º —Å–¥–µ–ª–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏–¥–µ—Ç—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
`catchSchemaFailure`

```ts filename="playlistsApi.ts" {6-9, 15-18, 26-29}
export const playlistsApi = baseApi.injectEndpoints({
  endpoints: (build) => ({
    fetchPlaylists: build.query({
      query: (params: FetchPlaylistsArgs) => ({ url: `playlists`, params }),
      responseSchema: playlistsResponseSchema,
      catchSchemaFailure: (err) => {
        errorToast("Zod error. Details in the console", err.issues)
        return { status: "CUSTOM_ERROR", error: "Schema validation failed" }
      },
      providesTags: ["Playlist"],
    }),
    createPlaylist: build.mutation({
      query: (body: CreatePlaylistArgs) => ({ url: "playlists", method: "post", body }),
      responseSchema: playlistCreateResponseSchema,
      catchSchemaFailure: (err) => {
        errorToast("Zod error. Details in the console", err.issues)
        return { status: "CUSTOM_ERROR", error: "Schema validation failed" }
      },
      invalidatesTags: ["Playlist"],
    }),
    uploadPlaylistCover: build.mutation({
      query: ({ playlistId, file }: { playlistId: string; file: File }) => {
        /*...*/
      },
      responseSchema: imagesSchema,
      catchSchemaFailure: (err) => {
        errorToast("Zod error. Details in the console", err.issues)
        return { status: "CUSTOM_ERROR", error: "Schema validation failed" }
      },
      invalidatesTags: ["Playlist"],
    }),
    /*...*/
  }),
})
```

–ù–∞–ø–∏—à–µ–º –Ω–µ–±–æ–ª—å—à—É—é –æ–±–µ—Ä—Ç–∫—É, —á—Ç–æ–±—ã –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥

- `common/utils/withZodCatch.ts`

```ts filename="withZodCatch.ts"
import { errorToast } from "@/common/utils/errorToast.ts"
import { type FetchBaseQueryError, NamedSchemaError } from "@reduxjs/toolkit/query/react"
import type { ZodType } from "zod"

export const withZodCatch = <T extends ZodType>(schema: T) => ({
  responseSchema: schema,
  catchSchemaFailure: (err: NamedSchemaError): FetchBaseQueryError => {
    errorToast("Zod error. Details in the console", err.issues)
    return {
      status: "CUSTOM_ERROR",
      error: "Schema validation failed",
    }
  },
})
```

- `playlistsApi.ts`

```ts filename="playlistsApi.ts" {5, 10, 17}
export const playlistsApi = baseApi.injectEndpoints({
  endpoints: (build) => ({
    fetchPlaylists: build.query({
      query: (params: FetchPlaylistsArgs) => ({ url: `playlists`, params }),
      ...withZodCatch(playlistsResponseSchema),
      providesTags: ["Playlist"],
    }),
    createPlaylist: build.mutation({
      query: (body: CreatePlaylistArgs) => ({ url: "playlists", method: "post", body }),
      ...withZodCatch(playlistCreateResponseSchema),
      invalidatesTags: ["Playlist"],
    }),
    uploadPlaylistCover: build.mutation({
      query: ({ playlistId, file }: { playlistId: string; file: File }) => {
        /*...*/
      },
      ...withZodCatch(imagesSchema),
      invalidatesTags: ["Playlist"],
    }),
    /*...*/
  }),
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≤—ã–Ω–µ—Å–ª–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ —É—Ç–∏–ª–∏—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `withZodCatch` üöÄ

### auth

–û—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–¥–µ–ª–∞—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –∞ –ø–æ—Ç–æ–º —Å–≤–µ—Ä–∏—Ç—å—Å—è —Å –Ω–∞—à–∏–º —Ä–µ—à–µ–Ω–∏–µ–º.

- `auth/model/auth.schemas.ts`

```ts filename="auth.schemas.ts"
import * as z from "zod"

export const meResponseSchema = z.object({
  userId: z.string(),
  login: z.string(),
})

export const loginResponseSchema = z.object({
  refreshToken: z.jwt(),
  accessToken: z.jwt(),
})
```

- `authApi.types.ts`

```ts filename="authApi.types.ts"
import { loginResponseSchema, type meResponseSchema } from "@/features/auth/model/auth.schemas.ts"
import * as z from "zod"

export type MeResponse = z.infer<typeof meResponseSchema>
export type LoginResponse = z.infer<typeof loginResponseSchema>

// Arguments
export type LoginArgs = {
  code: string
  redirectUri: string
  rememberMe: boolean
  accessTokenTTL?: string // e.g. "3m"
}
```

- `authApi.ts`

```ts filename="authApi.ts"
export const authApi = baseApi.injectEndpoints({
  endpoints: (build) => ({
    getMe: build.query({
      query: () => `auth/me`,
      ...withZodCatch(meResponseSchema),
      providesTags: ["Auth"],
    }),
    login: build.mutation({
      query: (payload: LoginArgs) => ({
        url: `auth/login`,
        method: "post",
        body: { ...payload, accessTokenTTL: "3m" },
      }),
      ...withZodCatch(loginResponseSchema),
      /*...*/
    }),
    /*...*/
  }),
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–∫—Ä—ã–ª–∏ `zod` –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è `auth` üöÄ

### tracks

–û—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–¥–µ–ª–∞—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –∞ –ø–æ—Ç–æ–º —Å–≤–µ—Ä–∏—Ç—å—Å—è —Å –Ω–∞—à–∏–º —Ä–µ—à–µ–Ω–∏–µ–º.

- `tracks/model/tracks.schemas.ts`

```ts filename="tracks.schemas.ts"
import * as z from "zod"
import { imagesSchema, currentUserReactionSchema, userSchema } from "@/common/schemas"

export const trackAttachmentSchema = z.object({
  id: z.string(),
  addedAt: z.iso.datetime(),
  updatedAt: z.iso.datetime(),
  version: z.int().nonnegative(),
  url: z.url(),
  contentType: z.string(),
  originalName: z.string(),
  fileSize: z.int().nonnegative(),
})

export const trackRelationshipsSchema = z.object({
  artists: z.object({
    data: z.array(
      z.object({
        id: z.string(),
        type: z.literal("artists"),
      }),
    ),
  }),
})

export const trackAttributesSchema = z.object({
  title: z.string(),
  addedAt: z.iso.datetime(),
  attachments: z.array(trackAttachmentSchema),
  images: imagesSchema,
  currentUserReaction: currentUserReactionSchema,
  user: userSchema,
  isPublished: z.boolean(),
  publishedAt: z.iso.datetime(),
})

export const tracksMetaSchema = z.object({
  nextCursor: z.string().nullable(),
  page: z.int().positive(),
  pageSize: z.int().positive(),
  totalCount: z.int().positive().nullable(),
  pagesCount: z.int().positive().nullable(),
})

export const tracksIncludedSchema = z.object({
  id: z.string(),
  type: z.literal("artists"),
  attributes: z.object({
    name: z.string(),
  }),
})

export const trackDataSchema = z.object({
  id: z.string(),
  type: z.literal("tracks"),
  attributes: trackAttributesSchema,
  relationships: trackRelationshipsSchema,
})

export const fetchTracksResponseSchema = z.object({
  data: z.array(trackDataSchema),
  included: z.array(tracksIncludedSchema),
  meta: tracksMetaSchema,
})
```

- `tracksApi.types.ts`

```ts filename="tracksApi.types.ts"
export type TrackAttachment = z.infer<typeof trackAttachmentSchema>
export type TrackRelationships = z.infer<typeof trackRelationshipsSchema>
export type TrackAttributes = z.infer<typeof trackAttributesSchema>
export type TrackData = z.infer<typeof trackDataSchema>
export type TracksIncluded = z.infer<typeof tracksIncludedSchema>
export type TracksMeta = z.infer<typeof tracksMetaSchema>
export type FetchTracksResponse = z.infer<typeof fetchTracksResponseSchema>

// Arguments
export type FetchTracksArgs = {
  pageNumber?: number
  pageSize?: number
  search?: string
  sortBy?: "publishedAt" | "likesCount"
  sortDirection?: "asc" | "desc"
  tagsIds?: string[]
  artistsIds?: string[]
  userId?: string
  includeDrafts?: boolean
  paginationType?: "offset" | "cursor"
  cursor?: string
}
```

‚ùó `withZodCatch` –¥–æ–±–∞–≤—å—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–∫—Ä—ã–ª–∏ `zod` –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ç—Ä–µ–∫–æ–≤ üöÄ

## skipschemavalidation

–ö –º–∏–Ω—É—Å–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `zod` —á–∞—Å—Ç–æ –æ—Ç–Ω–æ—Å—è—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

**1. –û–≤–µ—Ä—Ö–µ–¥ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**

- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU –∏ –ø–∞–º—è—Ç—å).

- –ï—Å–ª–∏ —Å—Ö–µ–º–∞ —Å–ª–æ–∂–Ω–∞—è –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö –æ—á–µ–Ω—å –º–Ω–æ–≥–æ, –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É.

- –ò–Ω–æ–≥–¥–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
  –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î –∏–ª–∏ API).

**2. –†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞ (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)**

- `Zod` –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç –¥–µ—Å—è—Ç–∫–∏ –∫–∏–ª–æ–±–∞–π—Ç –∫ –±–∞–Ω–¥–ª—É.

- –î–ª—è `SPA` –∏–ª–∏ `PWA` —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ—Ç–Ω—ã–º, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ–≤—Å—é–¥—É.

–ü–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –∏–≥—Ä–∞—é—Ç –∫–ª—é—á–µ–≤—É—é —Ä–æ–ª—å, —Ç–æ –≤ production zod –º–æ–∂–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏
`skipschemavalidation`

<Callout type={"info"} emoji={"üîó"}>
  - [skipschemavalidation](https://redux-toolkit.js.org/rtk-query/api/createApi#skipschemavalidation)
</Callout>

**–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```ts filename="baseApi.ts" {6}
export const baseApi = createApi({
  reducerPath: "baseApi",
  tagTypes: ["Playlist", "Auth"],
  endpoints: () => ({}),
  baseQuery: baseQueryWithReauth,
  skipSchemaValidation: process.env.NODE_ENV === "production",
})
```

**–õ–æ–∫–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–¥–ª—è –æ—Ç–µ–ª—å–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤):**

```ts filename="playlistsApi" {6}
export const playlistsApi = baseApi.injectEndpoints({
  endpoints: (build) => ({
    fetchPlaylists: build.query({
      query: (params: FetchPlaylistsArgs) => ({ url: `playlists`, params }),
      ...withZodCatch(playlistsResponseSchema),
      skipSchemaValidation: process.env.NODE_ENV === "production",
      providesTags: ["Playlist"],
    }),
  }),
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ç–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –∫–∞–∫ –≥–∏–±–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å zod üöÄ
