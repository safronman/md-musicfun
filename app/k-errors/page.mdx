import { Callout } from "nextra/components"

# 11. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í `RTK Query` –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ:

<Callout type={"info"} emoji={"üîó"}>
  - [Error Handling](https://redux-toolkit.js.org/rtk-query/usage/error-handling)

- [Type safe error handling](https://redux-toolkit.js.org/rtk-query/usage-with-typescript#type-safe-error-handling)

</Callout>

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ useQuery –∏ useMutation

`RTK Query` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è `error` –∏ `isError`,
–∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

```tsx filename="PlaylistsPage.tsx" /isError/ /error/
export const PlaylistsPage = () => {
  const { data, isLoading, error, isError } = useFetchPlaylistsQuery({
    search: debounceSearch,
    pageNumber: currentPage,
    pageSize,
  })

  if (error) {
    console.log(error)
  }

  /*...*/
}
```

–í `playlistApi` –∫–∞—á–µ—Å—Ç–≤–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–ª–æ–º–∞–µ–º url. –ù–∞–ø—Ä–∏–º–µ—Ä –≤–æ—Ç —Ç–∞–∫:

```ts filename="playlistApi.ts" /playlists2/
  fetchPlaylists: build.query<PlaylistsResponse, FetchPlaylistsArgs>({
      query: (params) => ({ url: `playlists2`, params }),
      providesTags: ['Playlist'],
    }),
```

–í –∫–æ–Ω—Å–æ–ª–∏ —É–≤–∏–¥–∏–º —Å–ª–µ–¥—É—é—â—É—é –æ—à–∏–±–∫—É:

```bash filename="console"
{
  "status": 404,
  "data": {
    "error": "Not Found",
    "message": "Cannot GET /api/1.0/playlists2?search=&pageNumber=1&pageSize=2",
    "statusCode": 404
  }
}
```

–ú–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:

```tsx filename="PlaylistsPage.tsx" {9}
export const PlaylistsPage = () => {
  const { data, isLoading, error } = useFetchPlaylistsQuery({
    search: debounceSearch,
    pageNumber: currentPage,
    pageSize,
  })

  if (error) {
    toast(error.data.error, { type: "error", theme: "colored" })
  }

  /*...*/
}
```

–ù–æ —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ `TS`. –°–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://redux-toolkit.js.org/rtk-query/usage-with-typescript#type-safe-error-handling) –≤ `RTK Query` –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –æ—à–∏–±–∫–∏.

#### FetchBaseQueryError

–ö–æ–≥–¥–∞ –æ—à–∏–±–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ –±–∞–∑–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (`base query`), `RTK Query` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç —ç—Ç—É –æ—à–∏–±–∫—É –Ω–∞–ø—Ä—è–º—É—é

- `'FETCH_ERROR'` - –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏
- `'PARSING_ERROR'` - –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- `'CUSTOM_ERROR'` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–∏–ø –æ—à–∏–±–∫–∏
- `'HTTP status code'` - status code –æ—à–∏–±–∫–∞ (401, 403, 500 –∏ —Ç.–¥.)

#### SerializedError

–ï—Å–ª–∏ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥ –≤—ã–±—Ä–æ—Å–∏—Ç –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É (–≤–º–µ—Å—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π), –æ–Ω–∞ –±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞
–≤ —Ñ–æ—Ä–º–∞—Ç `SerializedError`.

#### –õ–æ–∫–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏

- `PlaylistsPage.tsx`

```tsx filename="PlaylistsPage.tsx"
export const PlaylistsPage = () => {
  const { data, isLoading, error } = useFetchPlaylistsQuery({
    search: debounceSearch,
    pageNumber: currentPage,
    pageSize,
  })

  useEffect(() => {
    if (!error) return
    if ("status" in error) {
      // FetchBaseQueryError
      const errMsg = "error" in error ? error.error : (error.data as { message: string }).message
      toast(errMsg, { type: "error", theme: "colored" })
    } else {
      // SerializedError
      toast(error.message || "Some error occurred", { type: "error", theme: "colored" })
    }
  }, [error])

  /*...*/
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —É–≤–∏–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –æ—à–∏–±–∫–∏ üöÄ

–ï—Å–ª–∏ —Å–µ–π—á–∞—Å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `// 'API-KEY': import.meta.env.VITE_API_KEY,`, —Ç–æ —É–∂–µ –±—É–¥–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–¥ 429 –∏ –æ—à–∏–±–∫—É
–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ –¥—Ä—É–≥–æ–º—É

```bash filename="console"
{
  "status": 429,
  "data": {
    "message": "API key is invalid or not passed. (code=2) ",
    "statusCode": 429
  }
}
```

–ï—Å–ª–∏ –ø–∏—Å–∞—Ç—å –≤ –ª–æ–±, —Ç–æ –±—É–¥–µ—Ç –≤–æ—Ç —Ç–∞–∫

```tsx filename="PlaylistsPage.tsx"
useEffect(() => {
  if (!error) return
  if ("status" in error) {
    // FetchBaseQueryError
    const errMsg =
      "error" in error
        ? error.error
        : (
            error.data as {
              error: string
            }
          ).error ||
          (error.data as { message: string }).message ||
          "Some error occurred"
    toast(errMsg, { type: "error", theme: "colored" })
  } else {
    // SerializedError
    toast(error.message || "Some error occurred", { type: "error", theme: "colored" })
  }
}, [error])
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —É –Ω–∞—Å –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏, –Ω–æ:

1. –£ –Ω–∞—Å –ø–æ–ª—É—á–∏–ª—Å—è –∑–∞–≥—Ä–æ–º–æ–∂–¥–µ–Ω–Ω—ã–π –ª–æ–≥–∏–∫–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç üò¢
2. –õ–æ–≥–∏–∫–∞ –¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞–µ—Ç—Å—è üò¢
3. –ü—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫—É—é –∂–µ –ª–æ–≥–∏–∫—É –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å –ø–æ –≤—Å–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é, –≤–æ –≤—Å–µ—Ö –∫–≤–µ—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ –º—É—Ç–∞—Ü–∏—è—Ö üò¢

–ü–æ—ç—Ç–æ–º—É –¥–∞–≤–∞–π—Ç–µ —Å—Ä–∞–∑—É –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å –ø–æ –¥—Ä—É–≥–æ–º—É –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ üöÄ

## –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–º–æ—â—å—é baseQuery

–î–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
[–∫–∞—Å—Ç–æ–º–Ω—ã–π `baseQuery`](https://redux-toolkit.js.org/rtk-query/usage-with-typescript#typing-a-basequery),
–ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ `API`.

### Status codes (404, 429)

```ts filename="baseApi.ts"
export const baseApi = createApi({
  reducerPath: "baseApi",
  tagTypes: ["Playlist"],
  baseQuery: async (args, api, extraOptions) => {
    const result = await fetchBaseQuery({
      baseUrl: import.meta.env.VITE_BASE_URL,
      headers: {
        // "API-KEY": import.meta.env.VITE_API_KEY,
      },
      prepareHeaders: (headers) => {
        headers.set("Authorization", `Bearer ${import.meta.env.VITE_ACCESS_TOKEN}`)
        return headers
      },
    })(args, api, extraOptions)

    if (result.error) {
      switch (result.error.status) {
        case 404:
          toast((result.error.data as { error: string }).error, { type: "error", theme: "colored" })
          break

        case 429:
          // ‚úÖ 1. Type Assertions
          // toast((result.error.data as { message: string }).message, { type: 'error', theme: 'colored' })
          // ‚úÖ 2. JSON.stringify
          // toast(JSON.stringify(result.error.data), { type: 'error', theme: 'colored' })
          // ‚úÖ 3. Type Predicate
          if (isErrorWithMessage(result.error.data)) {
            toast(result.error.data.message, { type: "error", theme: "colored" })
          } else {
            toast(JSON.stringify(result.error.data), { type: "error", theme: "colored" })
          }
          break

        default:
          toast("Some error occurred", { type: "error", theme: "colored" })
      }
    }

    return result
  },
  endpoints: () => ({}),
})
```

<Callout type={"info"} emoji={"üîó"}>
  - [–í–∞—Ä–∏–∞–Ω—Ç—ã –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `unknown` –æ—à–∏–±–∫–∏ ](https://www.totaltypescript.com/concepts/object-is-of-type-unknown).
</Callout>

##### 1. Type Assertions

–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —á–µ—Ä–µ–∑ `as` (`type assertion`) –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã–º –æ—à–∏–±–∫–∞–º, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ
—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ç–∏–ø–µ –¥–∞–Ω–Ω—ã—Ö:

- [Type Assertions: TS documentation](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#type-assertions);
- [Type Assertions: Total TypeScript](https://www.totaltypescript.com/concepts/type-assertions).

##### 2. JSON.stringify

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç.

##### 3. Type Predicate

–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π [isErrorWithMessage](https://redux-toolkit.js.org/rtk-query/usage-with-typescript#inline-error-handling-example).

<Callout type={"info"} emoji={'üîó'}>
  –•–æ—Ä–æ—à–∏–π, –Ω–æ —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç:
  - [Using type predicates](https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates);

- [–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ TS –≤–µ—Ä—Å–∏–∏
  5.5](https://devblogs.microsoft.com/typescript/announcing-typescript-5-5/#inferred-type-predicates).

</Callout>

–°–æ–∑–¥–∞–π—Ç–µ –≤ `src/common/utils/isErrorWithMessage.ts` —É—Ç–∏–ª–∏—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `isErrorWithMessage`

```ts filename="src/common/utils/isErrorWithMessage.ts"
/* –°–∏–Ω—Ç–∞–∫—Å–∏—Å error is { message: string } –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, TypeScript –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å
error –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —Å—Ç—Ä–æ–∫–æ–≤—ã–º —Å–≤–æ–π—Å—Ç–≤–æ–º message. */
export function isErrorWithMessage(error: unknown): error is { message: string } {
  return (
    typeof error === "object" && // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ error ‚Äì —ç—Ç–æ –æ–±—ä–µ–∫—Ç
    error != null && // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —ç—Ç–æ –Ω–µ null
    "message" in error && // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –æ–±—ä–µ–∫—Ç–∞ –µ—Å—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ 'message'
    typeof (error as Record<string, unknown>).message === "string" // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
  )
}
```

–§—É–Ω–∫—Ü–∏—è `isErrorWithMessage` - —Ç–∏–ø–æ–≤–æ–π –ø—Ä–µ–¥–∏–∫–∞—Ç (`type predicate`) –≤ `TypeScript`. –û–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è
–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `error` –æ–±—ä–µ–∫—Ç–æ–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º —Å–≤–æ–π—Å—Ç–≤–æ `message` —Ç–∏–ø–∞ string.

`error is { message: string }` ‚Äì —Ç–∏–ø–æ–≤–æ–π –ø—Ä–µ–¥–∏–∫–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç `TypeScript`: "–µ—Å–ª–∏
—Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, —Ç–æ–≥–¥–∞ error —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º —Å –ø–æ–ª–µ–º `message` —Ç–∏–ø–∞ `string`".
–ë–µ–∑ —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏, `TS` –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ `boolean`.

–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–¥–µ–ª–∞–µ–º `isErrorWithError` –¥–ª—è 404.

–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```ts filename="baseApi.ts"
if (result.error) {
  switch (result.error.status) {
    case 404:
      if (isErrorWithError(result.error.data)) {
        toast(result.error.data.error, { type: "error", theme: "colored" })
      } else {
        toast(JSON.stringify(result.error.data), { type: "error", theme: "colored" })
      }
      break

    case 429:
      if (isErrorWithMessage(result.error.data)) {
        toast(result.error.data.message, { type: "error", theme: "colored" })
      } else {
        toast(JSON.stringify(result.error.data), { type: "error", theme: "colored" })
      }
      break

    default:
      toast("Some error occurred", { type: "error", theme: "colored" })
  }
}
```

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –¥–∂–µ–Ω–µ—Ä–∏–∫–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è

```ts filename="isErrorWithProperty.ts"
export function isErrorWithProperty<T extends string>(error: unknown, property: T): error is Record<T, string> {
  return (
    typeof error === "object" &&
    error != null &&
    property in error &&
    typeof (error as Record<string, unknown>)[property] === "string"
  )
}
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

`isErrorWithProperty(result.error.data, 'error')`
`isErrorWithProperty(result.error.data, 'message')`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ 404 –∏ 429 status code üöÄ

### Fetch, parsing, custom, timeout error

<Callout type={'info'} emoji={'üîó'}>

[fetchBaseQuery signature](https://redux-toolkit.js.org/rtk-query/api/fetchBaseQuery#signature)

</Callout>

```ts filename="baseApi.ts"
case 'FETCH_ERROR':
case 'PARSING_ERROR':
case 'CUSTOM_ERROR':
case 'TIMEOUT_ERROR':
  toast(result.error.error, { type: 'error', theme: 'colored' })
  break
```

–ö–∞–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –æ—à–∏–±–∫–∏

#### 'FETCH_ERROR'

–û—Ç–∫—Ä–æ–π—Ç–µ `developer tools`, –≤–∫–ª—é—á–∏—Ç–µ `offline` —Ä–µ–∂–∏–º –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç

#### 'PARSING_ERROR'

–í baseApi –±—É–¥–µ–º –≤—ã–¥–∏–¥—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π `JSON`

```ts
responseHandler: () => {
 throw new Error('PARSING_ERROR')
},
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ üöÄ

### Status codes (403, 401, 500)

#### 403

–ß—Ç–æ–±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∫–æ–¥:

- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–µ —Å–≤–æ–π –ø–ª–µ–π–ª–∏—Å—Ç
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –±–æ–ª—å—à–µ 10 –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤

–¢—É—Ç –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ. –ë–µ–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–µ—Ç –æ—à–∏–±–∫—É —Å–æ–≥–ª–∞—Å–Ω–æ [JSON:API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏](https://jsonapi.org/)

```ts filename="isErrorWithDetailArray.ts"
export function isErrorWithDetailArray(error: unknown): error is { errors: { detail: string }[] } {
  return (
    typeof error === "object" &&
    error !== null &&
    "errors" in error &&
    Array.isArray((error as any).errors) &&
    (error as any).errors.length > 0 &&
    typeof (error as any).errors[0].detail === "string"
  )
}
```

```ts filename="baseApi.ts"
case 403:
  if (isErrorWithDetailArray(result.error.data)) {
    toast(result.error.data.errors[0].detail, { type: "error", theme: "colored" })
  } else {
    toast(JSON.stringify(result.error.data), { type: "error", theme: "colored" })
  }
break
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ üöÄ

#### 400

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–∏–º–≤–æ–ª–æ–≤ –±–æ–ª—å—à–µ 100

```ts filename="baseApi.ts"
case 400:
case 403:
  if (isErrorWithDetailArray(result.error.data)) {
    toast(trimToMaxLength(result.error.data.errors[0].detail), { type: "error", theme: "colored" })
  } else {
    toast(JSON.stringify(result.error.data), { type: "error", theme: "colored" })
  }
break
```

- `common/utils/trimToMaxLength.ts`

```ts filename="common/utils/trimToMaxLength.ts"
export function trimToMaxLength(str: string, maxLength = 100): string {
  return str.length > maxLength ? str.slice(0, maxLength - 3) + "..." : str
}
```

#### 401

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π `access token`. –ü–æ–¥—É—á–∏—Ç–µ –æ—à–∏–±–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –¢—É—Ç –≤—Å–µ –ø—Ä–æ—Å—Ç–æ, –¥–∞–Ω–Ω—ã–π –∫–µ–π—Å —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω –≤
429

```ts filename="baseApi.ts"
case 401:
case 429:
  if (isErrorWithProperty(result.error.data, 'message')) {
    toast(result.error.data.message, { type: 'error', theme: 'colored' })
  } else {
  toast(JSON.stringify(result.error.data), { type: 'error', theme: 'colored' })
  }
break
```

#### 500-599

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–ø–∞—Å–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é "—Å—ã—Ä—ã–µ" —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ (500‚Äì599):**

1. **–£—Ç–µ—á–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**
   –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ —á–∞—Å—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–µ—Ç–∞–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: stack trace, –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü, SQL-–∑–∞–ø—Ä–æ—Å—ã,
   –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—É—Ç–∏, –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ —Ç.–¥. –¢–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏ –¥–ª—è –∞—Ç–∞–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É.

2. **–ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —Ö–∞–∫–µ—Ä–æ–≤**
   –°–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ ‚ÄúDatabase connection failed‚Äù –∏–ª–∏ ‚ÄúInvalid credentials for user admin‚Äù –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º,
   –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞, –∏ –º–æ–≥—É—Ç —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–¥–±–æ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–∏.

3. **–†–∞—Å–∫—Ä—ã—Ç–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   –°–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥–∞ ‚ÄúNullReferenceException in UserService‚Äù –∏–ª–∏ ‚ÄúModuleNotFoundError in utils/logger.js‚Äù —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç
   –¥–µ—Ç–∞–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∞—Ç–∞–∫—É—é—â–µ–≥–æ.

4. **–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –æ—à–∏–±–æ–∫**
   –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –≤—Å—ë —á—Ç–æ —É–≥–æ–¥–Ω–æ: –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏, —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏ –∏ –¥—Ä—É–≥–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ —Å–ª—É—á–∞–π–Ω–æ
   –ø–æ–ø–∞–¥—É—Ç –≤ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏.

**–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ**

–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–ª—å–∫–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
`–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`
–∏–ª–∏
`Server error occurred. Please try again later.`

**–í—Å–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ—à–∏–±–æ–∫ –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º.**

```ts filename="baseApi.ts"
default:
  if (result.error.status >= 500 && result.error.status < 600) {
    toast("Server error occurred. Please try again later.", { type: "error", theme: "colored" })
  } else {
    toast("Some error occurred", { type: "error", theme: "colored" })
  }
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ –≤—Å–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è üöÄ

### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

#### 1 —à–∞–≥

–ß—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–¥ `baseApi` –æ—Ç –¥–µ—Ç–∞–ª–µ–π, –≤—ã–Ω–µ—Å–∏—Ç–µ –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ —É—Ç–∏–ª–∏—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `handleErrors`:

```ts filename="baseApi.ts" {8}
export const baseApi = createApi({
  baseQuery: async (args, api, extraOptions) => {
    const result = await fetchBaseQuery({
      /*...*/
    })(args, api, extraOptions)

    if (result.error) {
      handleErrors(result.error)
    }

    return result
  },
})
```

- `common/utils/handleErrors.ts`

```ts filename="common/utils/handleErrors.ts"
export const handleErrors = (error: FetchBaseQueryError) => {
  if (error) {
    switch (error.status) {
      case "FETCH_ERROR":
      case "PARSING_ERROR":
      case "CUSTOM_ERROR":
      case "TIMEOUT_ERROR":
        toast(error.error, { type: "error", theme: "colored" })
        break

      case 400:
      case 403:
        if (isErrorWithDetailArray(error.data)) {
          toast(trimToMaxLength(error.data.errors[0].detail), { type: "error", theme: "colored" })
        } else {
          toast(JSON.stringify(error.data), { type: "error", theme: "colored" })
        }
        break

      case 404:
        if (isErrorWithProperty(error.data, "error")) {
          toast(error.data.error, { type: "error", theme: "colored" })
        } else {
          toast(JSON.stringify(error.data), { type: "error", theme: "colored" })
        }
        break

      case 401:
      case 429:
        if (isErrorWithProperty(error.data, "message")) {
          toast(error.data.message, { type: "error", theme: "colored" })
        } else {
          toast(JSON.stringify(error.data), { type: "error", theme: "colored" })
        }
        break

      default:
        if (error.status >= 500 && error.status < 600) {
          toast("Server error occurred. Please try again later.", { type: "error", theme: "colored" })
        } else {
          toast("Some error occurred", { type: "error", theme: "colored" })
        }
    }
  }
}
```

#### 2 —à–∞–≥

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –º—ã –≤–µ–∑–¥–µ —É–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∏–ª—å –¥–ª—è —Ç–æ—Å—Ç–µ—Ä–∞ —Å –æ—à–∏–±–∫–æ–π (`{ type: "error", theme: "colored" }`)

–°–æ–∑–¥–∞–¥–∏–º 2 –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ—Å—Ç–æ–≤

- `common/utils/errorToast.ts`

```ts filename="errorToast.ts"
export const errorToast = (message: string, error?: unknown) => {
  toast(message, { theme: "colored", type: "error" })

  if (error) {
    console.error(`${message}\n`, error)
  }
}
```

- `common/utils/succesToast.ts`

```ts filename="successToast.ts"
export const successToast = (message: string) => {
  toast(message, { theme: "colored", type: "success" })
}
```

- `handleErrors.ts`

```ts filename="handleErrors.ts" /errorToast/
export const handleErrors = (error: FetchBaseQueryError) => {
  if (error) {
    switch (error.status) {
      case "FETCH_ERROR":
      case "PARSING_ERROR":
      case "CUSTOM_ERROR":
      case "TIMEOUT_ERROR":
        errorToast(error.error)
        break

      case 400:
      case 403:
        if (isErrorWithDetailArray(error.data)) {
          errorToast(trimToMaxLength(error.data.errors[0].detail))
        } else {
          errorToast(JSON.stringify(error.data))
        }
        break

      case 404:
        if (isErrorWithProperty(error.data, "error")) {
          errorToast(error.data.error)
        } else {
          errorToast(JSON.stringify(error.data))
        }
        break

      case 401:
      case 429:
        if (isErrorWithProperty(error.data, "message")) {
          errorToast(error.data.message)
        } else {
          errorToast(JSON.stringify(error.data))
        }
        break

      default:
        if (error.status >= 500 && error.status < 600) {
          errorToast("Server error occurred. Please try again later.", error)
        } else {
          errorToast("Some error occurred")
        }
    }
  }
}
```

<Callout type={"warning"}>–ó–∞–º–µ–Ω–∏—Ç–µ `toast` –Ω–∞ `errorToast` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `PlaylistCover.ts`</Callout>

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω, –≤—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã üöÄ
