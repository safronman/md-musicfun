import { Callout } from "nextra/components"

# 3. Mutation

[–ú—É—Ç–∞—Ü–∏–∏](https://redux-toolkit.js.org/rtk-query/usage/mutations) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤ –∫–µ—à–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
–º—É—Ç–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à–µ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏—Ö –ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å.

## –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞

### Api

–†–µ–∞–ª–∏–∑—É–µ–º –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://musicfun.it-incubator.app/api#/Playlists%20Owner/PlaylistsController_createPlaylist).

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `mutation` —É `build`:

```ts filename="playlistsApi.ts"
export const playlistsApi = createApi({
  /*...*/
  endpoints: (build) => ({
    /*...*/
    createPlaylist: build.mutation<{ data: Playlist }, CreatePlaylistArgs>({
      query: (body) => ({
        url: "playlists",
        method: "post",
        body,
      }),
    }),
  }),
})

export const { useFetchPlaylistsQuery, useCreatePlaylistMutation } = playlistsApi
```

```ts filename="playlistsApi.types.ts"
/*...*/
// Arguments
export type CreatePlaylistArgs = {
  title: string
  description: string
}
```

### UI

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç, –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –∫—É–¥–∞ –±—É–¥–µ–º –≤–≤–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ—Ç–æ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Ö
–Ω–∞ —Å–µ—Ä–≤–µ—Ä.
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–æ—Ä–º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É [react-hook-form](https://react-hook-form.com/)

```bash filename="Terminal"
pnpm add react-hook-form
```

–°–æ–∑–¥–∞–¥–∏–º —Ñ–æ—Ä–º—É –∏ –≤—ã–≤–µ–¥–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª—å

```tsx filename="src/features/playlists/PlaylistsPage/CreatePlaylistForm/CreatePlaylistForm.tsx"
export const CreatePlaylistForm = () => {
  const { register, handleSubmit } = useForm<CreatePlaylistArgs>()

  const onSubmit: SubmitHandler<CreatePlaylistArgs> = (data) => {
    console.log(data)
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <h2>Create new playlist</h2>
      <div>
        <input {...register("title")} placeholder={"title"} />
      </div>
      <div>
        <input {...register("description")} placeholder={"description"} />
      </div>
      <button>create playlist</button>
    </form>
  )
}
```

```tsx filename="PlaylistsPage.tsx" {7}
export const PlaylistsPage = () => {
  const { data } = useFetchPlaylistsQuery()

  return (
    <div className={s.container}>
      <h1>Playlists page</h1>
      <CreatePlaylistForm />
      {/*...*/}
    </div>
  )
}
```

![create-playlist-form-console](https://production-it-incubator.s3.eu-central-1.amazonaws.com/file-manager/Image/5c0eaed0-8d0a-4675-aaff-5e42fa99fde0_create-playlist-form-console.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–≤–µ–¥–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º—É –∏ —É–±–µ–¥–∏–º—Å—è —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å üöÄ

### useMutation

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö—É–∫ [useMutation](https://redux-toolkit.js.org/rtk-query/api/created-api/hooks#usemutation) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤:

```tsx
const [createPlaylist, result] = useCreatePlaylistMutation()
```

1. –ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞;
2. –í—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä - –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –∑–∞–ø—Ä–æ—Å–µ.

```tsx filename="CreatePlaylistForm.tsx" {4,7}
export const CreatePlaylistForm = () => {
  const { register, handleSubmit } = useForm<CreatePlaylistArgs>()

  const [createPlaylist] = useCreatePlaylistMutation()

  const onSubmit: SubmitHandler<CreatePlaylistArgs> = (data) => {
    createPlaylist(data)
  }

  /*...*/
}
```

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

![401-error](https://production-it-incubator.s3.eu-central-1.amazonaws.com/file-manager/Image/6c0f0cee-49f3-42d5-a183-3523ce725b49_401-error.png)

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—É–¥—É–ª–∏—Å—Ç—ã –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –ß—Ç–æ–±—ã –±–µ–∫–µ–Ω–¥ –ø–æ–Ω—è–ª –∫—Ç–æ –Ω–µ–º—É
—Å—Ç—É—á–∏—Ç—Å—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ `Header` –ø–µ—Ä–µ–¥–∞—Ç—å `accessToken` –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø—Ä–∏ –ª–æ–≥–∏–Ω–∏–∑–∞—Ü–∏–∏.

<Callout type={'warning'}>

–¢–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–∞—è –∏ –Ω–µ —Ö–æ—á–µ—Ç—Å—è —Å–µ–π—á–∞—Å –Ω–∞—á–∏–Ω–∞—Ç—å —Å –Ω–µ–µ. –ü–æ—ç—Ç–æ–º—É –º—ã –≤
[–∑–∞–ª–æ–≥–∏–Ω–∏–º—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ Swagger](https://musicfun.it-incubator.app/api#/Authentication/AuthController_login), –ø–æ–ª—É—á–∏–º
`accessToken` –∏ –ø—Ä–∏–∫—Ä–µ–ø–∏–º –µ–≥–æ –∫ –∑–∞–ø—Ä–æ—Å.

‚ùó–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ—é –≤ `RTK query` —Ä–∞–∑–±–µ—Ä–µ–º –ø–æ–∑–∂–µ.

</Callout>

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π `accessToken` –ø–æ–ª–æ–∂–∏–º –≤ `.env.local`

```env filename=".env.local" {3}
VITE_BASE_URL=https://musicfun.it-incubator.app/api/1.0
VITE_API_KEY=xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx
VITE_ACCESS_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxIiwibG9naW4iOiJzYWZyb25tYW4iLCJpYXQiOjE3NTIyMzk2OTIsImV4cCI6MTc1MjMyNjA5Mn0.bfQs5OgJKwKBQj8uk1uOEW1I7eIyWKtQTOXMvB0yxoo
```

`accessToken` –Ω—É–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º, –ø–æ—ç—Ç–æ–º—É –¥–æ—Ä–∞–±–æ—Ç–∞–µ–º `playlistsApi.ts`

```tsx filename="playlistsApi.ts" {8-11}
export const playlistsApi = createApi({
  reducerPath: "playlistsApi",
  baseQuery: fetchBaseQuery({
    baseUrl: import.meta.env.VITE_BASE_URL,
    headers: {
      "API-KEY": import.meta.env.VITE_API_KEY,
    },
    prepareHeaders: (headers) => {
      headers.set("Authorization", `Bearer ${import.meta.env.VITE_ACCESS_TOKEN}`)
      return headers
    },
  }),
  /*...*/
})
```

–ï—â–µ —Ä–∞–∑ –ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç. –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –≤–∏–¥–∏–º, —á—Ç–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç

![create-playlust-success](https://production-it-incubator.s3.eu-central-1.amazonaws.com/file-manager/Image/50be3f04-1277-4989-9724-211d6704010e_create-playlust-success.png)

`accessToken` —Ü–µ–ø–ª—è–µ—Ç—Å—è –≤ `Headers`

![accessToken](https://production-it-incubator.s3.eu-central-1.amazonaws.com/file-manager/Image/98cd9732-7f5e-4b5e-95c6-8a07c4e22def_accessToken.png)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –µ—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, –º–æ–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏
–Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ üöÄ

## –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞

–†–µ–∞–ª–∏–∑—É–µ–º –ª–æ–≥–∏–∫—É —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://musicfun.it-incubator.app/api#/Playlists%20Owner/PlaylistsController_deletePlaylist).

```ts filename="playlistsApi.ts"
export const playlistsApi = createApi({
  /*...*/
  endpoints: (build) => ({
    /*...*/
    deletePlaylist: build.mutation<void, string>({
      query: (playlistId) => ({
        url: `playlists/${playlistId}`,
        method: "delete",
      }),
    }),
  }),
})
```

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `PlaylistsPage.tsx` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö—É–∫ `useDeletePlaylistMutation`:

```tsx filename="PlaylistsPage.tsx" {3, 5-9, 22}
export const PlaylistsPage = () => {
  const { data } = useFetchPlaylistsQuery()
  const [deletePlaylist] = useDeletePlaylistMutation()

  const deletePlaylistHandler = (playlistId: string) => {
    if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç?")) {
      deletePlaylist(playlistId)
    }
  }

  return (
    <div className={s.container}>
      <h1>Playlists page</h1>
      <CreatePlaylistForm />
      <div className={s.items}>
        {data?.data.map((playlist) => {
          return (
            <div className={s.item} key={playlist.id}>
              <div>title: {playlist.attributes.title}</div>
              <div>description: {playlist.attributes.description}</div>
              <div>userName: {playlist.attributes.user.name}</div>
              <button onClick={() => deletePlaylistHandler(playlist.id)}>delete</button>
            </div>
          )
        })}
      </div>
    </div>
  )
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –µ—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, –º–æ–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏
–Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ üöÄ

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞

–†–µ–∞–ª–∏–∑—É–µ–º –ª–æ–≥–∏–∫—É —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://musicfun.it-incubator.app/api#/Playlists%20Owner/PlaylistsController_updatePlaylist).

```ts filename="todolistsApi.ts" {5-11} /useUpdateTodolistTitleMutation/
export const todolistsApi = createApi({
  /*...*/
  endpoints: (build) => ({
    /*...*/
    updateTodolistTitle: build.mutation<BaseResponse, { id: string; title: string }>({
      query: ({ id, title }) => ({
        url: `todo-lists/${id}`,
        method: "PUT",
        body: { title },
      }),
    }),
  }),
})

export const {
  useGetTodolistsQuery,
  useAddTodolistMutation,
  useRemoveTodolistMutation,
  useUpdateTodolistTitleMutation,
} = todolistsApi
```

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `TodolistTitle` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö—É–∫ `useUpdateTodolistTitleMutation` –∏ —É–¥–∞–ª–∏—Ç–µ `useAppDispatch`:

```ts filename="TodolistTitle.tsx"
export const TodolistTitle = ({ todolist }: Props) => {
  const [updateTodolistTitle] = useUpdateTodolistTitleMutation()

  const updateTodolistHandler = (title: string) => {
    updateTodolistTitle({ id, title })
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –µ—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç—É–¥—É–ª–∏—Å—Ç–∞ –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, –º–æ–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ üöÄ
