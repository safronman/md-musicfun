import { Callout } from "nextra/components"

# 10. Loaders

## Query Loading State

### isLoading vs isFetching

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ `RTK Query` —Ö—É–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –±—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
[Query Loading State](https://redux-toolkit.js.org/rtk-query/usage/queries#query-loading-state),
–∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

1. **`isLoading`** –±—É–¥–µ—Ç `true`, –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–≤–ø–µ—Ä–≤—ã–µ** –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ö—É–∫–∞ –∏ –¥–∞–Ω–Ω—ã–µ **–µ—â—ë –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã**.
   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è `Skeleton` –∏–ª–∏ –ø—É—Å—Ç–æ–π –∑–∞–≥–ª—É—à–∫–∏, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ;

2. **`isFetching`** –±—É–¥–µ—Ç `true`, –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞,
   –Ω–æ **–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
   –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (`LinearProgress`).

–í—ã–≤–µ–¥–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å `isLoading, isFetching` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `PlaylistsPage.tsx`

```tsx filename="PlaylistsPage.tsx" /isLoading/ /isFetching/
export const PlaylistsPage = () => {
  /*...*/

  const { data, isLoading, isFetching } = useFetchPlaylistsQuery({
    search: debounceSearch,
    pageNumber: currentPage,
    pageSize,
  })

  console.log({ isLoading, isFetching })

  /*...*/
}
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ `isFetching` –∏ `isLoading` –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ:

```bash filename="console"
{isLoading: true, isFetching: true} // –∑–∞–ø—Ä–æ—Å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
{isLoading: false, isFetching: false} // –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω
```

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (`endpoint` —Ç–æ—Ç –∂–µ, –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `query`-–ø–∞—Ä–∞–º–µ—Ç—Ä `page`) `isFetching`
—Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö, –∞ `isLoading` –Ω–µ—Ç:

```bash filename="console"
{isLoading: false, isFetching: true} // –∑–∞–ø—Ä–æ—Å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
{isLoading: false, isFetching: false} // –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω
```

### –õ–æ–∫–∞–ª—å–Ω—ã–π loader

–ß—Ç–æ–±—ã –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤–∏–¥–µ—Ç—å –ª–æ–∞–¥–µ—Ä, —Å–¥–µ–ª–∞–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –≤ 2 —Å–µ–∫—É–Ω–¥—ã

```ts filename="baseApi.ts"
export const baseApi = createApi({
  reducerPath: "baseApi",
  tagTypes: ["Playlist"],
  baseQuery: async (args, api, extraOptions) => {
    await new Promise((resolve) => setTimeout(resolve, 2000)) // delay

    return fetchBaseQuery({
      baseUrl: import.meta.env.VITE_BASE_URL,
      headers: {
        "API-KEY": import.meta.env.VITE_API_KEY,
      },
      prepareHeaders: (headers) => {
        headers.set("Authorization", `Bearer ${import.meta.env.VITE_ACCESS_TOKEN}`)
        return headers
      },
    })(args, api, extraOptions)
  },
  endpoints: () => ({}),
})
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ `isLoading` –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `skeleton`.

<Callout type={'info'} emoji={'üîó'}>

–°–µ–π—á–∞—Å —Å–∫–µ–ª–µ—Ç–æ–Ω –º—ã –Ω–µ –±—É–¥–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å, —Ç.–∫. –Ω–∞ –≤–µ—Ä—Å—Ç–∫—É —Å–µ–π—á–∞—Å –º—ã –∞–∫—Ü–µ–Ω—Ç –Ω–µ –¥–µ–ª–∞–µ–º. –ù–æ –≤ –∫–∞—á–µ—Ç—Å–≤–µ –¥–æ–º–∞—à–Ω–µ–≥–æ
–∑–∞–¥–∞–Ω–∏—è –º–æ–∂–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è –±–∏–±–ª–∏–æ—Ç–µ–∫—É [react loading
skeleton](https://www.npmjs.com/package/react-loading-skeleton)

</Callout>

–ê –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ —Å–≤–æ–π—Å—Ç–≤–æ `isFetching` –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å `LinearProgress`

```tsx filename="PlaylistsPage.tsx" /isLoading/ /isFetching/
export const PlaylistsPage = () => {
  /*...*/

  if (isLoading) return <h1>Skeleton loader...</h1>

  return (
    <div className={s.container}>
      <h1>Playlists page</h1>
      <CreatePlaylistForm />
      <input type="search" placeholder={"Search playlist by title"} onChange={searchPlaylistHandler} />
      <PlaylistsList playlists={data?.data || []} isPlaylistsLoading={isLoading} />
      {isFetching && <LinearProgress />}
      {/*...*/}
    </div>
  )
}
```

- `common/components/LinearProgress/LinearProgress.tsx`

```tsx filename="LinearProgress.tsx"
import s from "./LinearProgress.module.css"

type Props = {
  height?: number
}

export const LinearProgress = ({ height = 4 }: Props) => {
  return (
    <div className={s.root} style={{ height }}>
      <div className={`${s.bar} ${s.indeterminate1}`} />
      <div className={`${s.bar} ${s.indeterminate2}`} />
    </div>
  )
}
```

- `common/components/LinearProgress/LinearProgress.module.css`

```css filename="LinearProgress.module.css"
.root {
  background: #23272f;
  border-radius: 8px;
  overflow: hidden;
  position: relative;
  width: 100%;
}

.bar {
  height: 100%;
  background: #ddd;
  position: absolute;
}

@keyframes indeterminate1 {
  0% {
    left: -35%;
    right: 100%;
  }
  60% {
    left: 100%;
    right: -90%;
  }
  100% {
    left: 100%;
    right: -90%;
  }
}

@keyframes indeterminate2 {
  0% {
    left: -200%;
    right: 100%;
  }
  60% {
    left: 107%;
    right: -8%;
  }
  100% {
    left: 107%;
    right: -8%;
  }
}

.indeterminate1 {
  animation: indeterminate1 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
}

.indeterminate2 {
  animation: indeterminate2 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) infinite;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è `PlaylistsPage` üöÄ

## –ì–ª–æ–±–∞–ª—å–Ω—ã–π loader

–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤. –ù–æ, –Ω–∞–º –∂–µ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
–ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ / —É–¥–∞–ª–µ–Ω–∏–∏/ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞. –ê –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –≤—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.

–°–æ–æ—Ç–≤–µ—Å—Ç–≤–µ–Ω–Ω–æ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –∏–º–µ—Ç—å –∫–∞–∫–æ–π-—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–π loading.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∞–∫–æ–π loading:

- –Ω–∞–ø–∏—Å–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π `middleware`
- —Å–æ–∑–¥–∞—Ç—å `slice` –∏ –≤ –Ω–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `builder.addMatcher`
- –Ω–∞–ø–∏—Å–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ `useGlobalLoading`

–û—Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –Ω–∞ —Å–∞–º–æ–º –ø—Ä–æ—Å—Ç–æ–º, –Ω–æ —Ä–∞–±–æ—á–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ. –ù–∞–ø–∏—à–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ `useGlobalLoading`

### useGlobalLoading

- `common/hooks/useGlobalLoading.ts`

```ts filename="useGlobalLoading.ts"
import type { RootState } from "@/app/model/store.ts"
import { useSelector } from "react-redux"

export const useGlobalLoading = () => {
  return useSelector((state: RootState) => {
    // Get all active requests from RTK Query API
    const queries = Object.values(state.baseApi.queries || {})
    const mutations = Object.values(state.baseApi.mutations || {})

    // Check if there are any active requests (status 'pending')
    const hasActiveQueries = queries.some((query) => query?.status === "pending")
    const hasActiveMutations = mutations.some((mutation) => mutation?.status === "pending")

    return hasActiveQueries || hasActiveMutations
  })
}
```

- `store.ts`

```ts filename="store.ts" {5}
export const store = configureStore({
  /*...*/
})

export type RootState = ReturnType<typeof store.getState>
```

- `App.tsx`

```tsx filename="App.tsx" {2,7}
export const App = () => {
  const isGlobalLoading = useGlobalLoading()

  return (
    <>
      <Header />
      {isGlobalLoading && <LinearProgress />}
      <div className={s.layout}>
        <Routing />
      </div>
      <ToastContainer />
    </>
  )
}
```

<Callout type={"warning"}>
  –ò–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ `PlaylistsPage.tsx` —É–¥–∞–ª–∏—Ç–µ `isFetching`, —Ç.–∫. –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ
</Callout>

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ç–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è `LinearProgress` üöÄ

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è –µ–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

–ï—Å–ª–∏ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –µ–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –º—ã —Ö–æ—Ç–∏–º —Å–¥–µ–ª–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è, —Ç–æ –ø—Ä–æ—Å—Ç–æ –±—É–¥–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –∏—Ö –≤ –º–∞—Å—Å–∏–≤ `excludedEndpoints`

```ts filename="useGlobalLoading.ts" {1-5, 15, 19}
// List of endpoints to exclude from the global indicator
const excludedEndpoints = [
  playlistsApi.endpoints.fetchPlaylists.name,
  // You can add other endpoints here if needed
]

export const useGlobalLoading = () => {
  return useSelector((state: RootState) => {
    // Get all active requests from RTK Query API
    const queries = Object.values(state.baseApi.queries || {})
    const mutations = Object.values(state.baseApi.mutations || {})

    // Check if there are any active requests (status 'pending')
    const hasActiveQueries = queries.some((query) => {
      return query?.status === "pending" && !excludedEndpoints.includes(query.endpointName)
    })

    const hasActiveMutations = mutations.some((mutation) => {
      return mutation?.status === "pending" && !excludedEndpoints.includes(mutation.endpointName)
    })

    return hasActiveQueries || hasActiveMutations
  })
}
```

**–ü–ª—é—Å—ã —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**

- **Type Safety** - `TypeScript` –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ `endpoint` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç üöÄ
- **Refactoring Safety** - –µ—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ—Ç–µ `endpoint`, –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ üöÄ
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - —Å—Ä–∞–∑—É –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ `endpoint` –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è üöÄ
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã –∏–ª–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã üöÄ
