import { Callout } from "nextra/components"

# Zod. Redux toolkit

üîó [–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥](https://github.com/safronman/zod-redux-toolkit-rtk-query/tree/d2eb1d14481bc6053d4d7378164e1630b4edf23c)

<Callout type={"error"} emoji={"‚ùó"}>
  –í —Ñ–∞–π–ª–µ .env –∑–∞–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `VITE_AUTH_TOKEN` –∏ `VITE_API_KEY` –Ω–∞ —Ç–µ, —á—Ç–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–∞—à–µ–≥–æ
  [–∞–∫–∫–∞—É–Ω—Ç–∞](https://social-network.samuraijs.com/account)
</Callout>

## –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–∞—Å–æ–∫

–í —Å—Ç—Ä–æ–∫–µ —Å –ø–æ–º–µ—Ç–∫–æ–π `üíé ZOD` –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏—à–ª–∏ —Ç–∞—Å–∫–∏ —Å –Ω—É–∂–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ –∏ —É –Ω–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø.

```tsx filename="tasks-slice.ts" {6}
fetchTasksTC: create.asyncThunk(
      async (todolistId: string, { dispatch, rejectWithValue }) => {
        try {
          dispatch(setAppStatusAC({ status: "loading" }))
          const res = await tasksApi.getTasks(todolistId)
          domainTaskSchema.array().parse(res.data.items) // üíé ZOD
          dispatch(setAppStatusAC({ status: "succeeded" }))
          return { todolistId, tasks: res.data.items }
        } catch (error) {
          catchErrorHandler(error, dispatch)
          return rejectWithValue(error)
        }
      },
      {
        fulfilled: (state, action) => {
          state[action.payload.todolistId] = action.payload.tasks
        },
      },
    ),
```

–ù–æ –∫–æ–≥–¥–∞ –º—ã –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞ —Ç–∞—Å–∫–∞–º–∏, —Ç–æ –ø–æ–º–∏–º–æ —Å–∞–º–∏—Ö —Ç–∞—Å–æ–∫ –Ω–∞–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ—â–µ –∏ `error` –∏ `totalCount`

```ts filename="tasksApi.types.ts"
export type GetTasksResponse = {
  error: string | null
  totalCount: number
  items: DomainTask[]
}
```

–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –º—ã –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–∏ —Å–≤–æ–π—Å—Ç–≤–∞, –ø–æ—ç—Ç–æ–º—É –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏—Ö —Å–º—ã—Å–ª–∞ –æ—Å–æ–±–æ–≥–æ –Ω–µ—Ç.
–¢.–µ. –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–∏–¥—É—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏, —Ç–æ —ç—Ç–æ –Ω–∏–∫–∞–∫ –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ù–æ –≤—Å–µ –∂–µ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –∫–∞—Ä—Ç–∏–Ω—ã –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –≤–µ—Å—å –æ—Ç–≤–µ—Ç —Ü–µ–ª–∏–∫–æ–º, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–ø–∏—à–µ–º –Ω–æ–≤—É—é —Å—Ö–µ–º—É –∏
–ø—Ä–æ–≤–µ—Ä–∏–º –µ–µ –≤ `thunk`

```ts filename="tasksApi.types.ts"
export const getTasksSchema = z.object({
  error: z.string().nullable(),
  totalCount: z.number().int().nonnegative(),
  items: domainTaskSchema.array(),
})

export type GetTasksResponse = z.infer<typeof getTasksSchema>
```

```tsx filename="tasks-slice.ts" {6}
fetchTasksTC: create.asyncThunk(
      async (todolistId: string, { dispatch, rejectWithValue }) => {
        try {
          dispatch(setAppStatusAC({ status: "loading" }))
          const res = await tasksApi.getTasks(todolistId)
          getTasksSchema.parse(res.data) // üíé ZOD
          dispatch(setAppStatusAC({ status: "succeeded" }))
          return { todolistId, tasks: res.data.items }
        } catch (error) {
          catchErrorHandler(error, dispatch)
          return rejectWithValue(error)
        }
      },
    ),
```

–¢.–∫. —É –Ω–∞—Å –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ç–æ –≤—Å–µ –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ üöÄ

ü§î –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã –≤ —Ç–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –≤—ã –Ω–∞–ø–∏—Å–∞–ª–∏, —Ç–æ `getTasksSchema` –≤ `error` —É–±–µ—Ä–∏—Ç–µ `.nullable()` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å,
—á—Ç–æ –æ—à–∏–±–∫–∞ —É–ø–∞–¥–µ—Ç

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞—Å–∫–∏

–ö–æ–≥–¥–∞ –º—ã —Å–æ–∑–¥–∞–µ–º —Ç–∞—Å–∫—É, –º—ã —Ç–æ–∂–µ —Ö–æ—Ç–∏–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º —Å–µ—Ä–≤–µ—Ä. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞—Å–∫–∏ –º—ã
–ø–æ–ª—É—á–∞–µ–º —Å —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –º—ã –≤—ã–Ω–µ—Å–ª–∏ –≤ –¥–∂–µ–Ω–µ—Ä–∏–∫–æ–≤—ã–π —Ç–∏–ø
`BaseResponse<{ item: DomainTask }>`. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∂–Ω–µ–Ω–µ—Ä–∏–∫–∞–º–∏ –≤ `ZOD`

<Callout type={"info"} emoji={"üîó"}>
  [Writing generic functions](https://zod.dev/?id=writing-generic-functions)
</Callout>

```ts filename="common/types/types.ts"
export const fieldErrorSchema = z.object({
  error: z.string(),
  field: z.string(),
})

type FieldError = z.infer<typeof fieldErrorSchema>

export type BaseResponse<T = {}> = {
  data: T
  resultCode: number
  messages: string[]
  fieldsErrors: FieldError[]
}

export const baseResponseSchema = <T extends z.ZodTypeAny>(schema: T) =>
  z.object({
    data: schema,
    resultCode: z.nativeEnum(ResultCode),
    messages: z.string().array(),
    fieldsErrors: fieldErrorSchema.array(),
  })
```

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞—Å–∫–∏ —É –Ω–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É –¥–∞–¥–∏–º –µ–º—É
–æ–±—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ `taskOperationResponseSchema`

```ts filename="tasksApi.types.ts"
export const taskOperationResponseSchema = baseResponseSchema(
  z.object({
    item: domainTaskSchema,
  }),
)
export type TaskOperationResponse = z.infer<typeof taskOperationResponseSchema>
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TaskOperationResponse` –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

```ts filename="tasksApi.ts" /TaskOperationResponse/
export const tasksApi = {
  createTask(payload: { todolistId: string; title: string }) {
    const { todolistId, title } = payload
    return instance.post<TaskOperationResponse>(`/todo-lists/${todolistId}/tasks`, { title })
  },
  updateTask(payload: { todolistId: string; taskId: string; model: UpdateTaskModel }) {
    const { todolistId, taskId, model } = payload
    return instance.put<TaskOperationResponse>(`/todo-lists/${todolistId}/tasks/${taskId}`, model)
  },
}
```

–ò –≤ `thunk` —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –ø–æ–º–æ—â–∏ `ZOD`

```ts filename="tasks-slice.ts" {6}
createTaskTC: create.asyncThunk(
      async (payload: { todolistId: string; title: string }, { dispatch, rejectWithValue }) => {
        try {
          dispatch(setAppStatusAC({ status: "loading" }))
          const res = await tasksApi.createTask(payload)
          taskOperationResponseSchema.parse(res.data) // üíé ZOD
          if (res.data.resultCode === ResultCode.Success) {
          /*...*/
          }
        } catch (error) {
          /*...*/
        }
      },
      /*...*/
    ),
```

**‚åö –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**

- `Zod` –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `thunk` –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Ç–∞—Å–∫–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—É–¥—É–ª–∏—Å—Ç–∞

- –ü—Ä–∏ –ø–æ–º–æ—â–∏ `ZOD` –æ–ø–∏—à–µ–º —Å—Ö–µ–º—É –¥–ª—è —Ç—É–¥—É–ª–∏—Å—Ç–∞
- –°–æ–∑–¥–∞–¥–∏–º `createTodolistResponseSchema` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—É–¥—É–ª–∏—Å—Ç–∞

```ts filename="todolistApi.types.ts"
// ‚ùå
// export type Todolist = {
//   id: string
//   title: string
//   addedDate: string
//   order: number
// }

export const todolistSchema = z.object({
  id: z.string(),
  title: z.string(),
  addedDate: z.string().datetime({ local: true }),
  order: z.number(),
})

export type Todolist = z.infer<typeof todolistSchema>

export const createTodolistResponseSchema = baseResponseSchema(
  z.object({
    item: todolistSchema,
  }),
)

export type CreateTodolistResponse = z.infer<typeof createTodolistResponseSchema>
```

–í–Ω–µ—Å–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `todolistsApi.ts`

```ts filename="todolistApi.ts" /Todolist[]/ /CreateTodolistResponse/
export const todolistsApi = {
  getTodolists() {
    return instance.get<Todolist[]>("/todo-lists")
  },
  createTodolist(title: string) {
    return instance.post<CreateTodolistResponse>("/todo-lists", { title })
  },
}
```

**‚åö –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**

- –¥–æ–±–∞–≤—å—Ç–µ `Zod` –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `fetchTodolistsTC` –∏ `createTodolistTC`

## –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∞—Å–∫–∏, —É–¥–∞–ª–µ–Ω–∏–µ —Ç—É–¥—É–ª–∏—Å—Ç–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤ —Ç—É–¥—É–ª–∏—Å—Ç–µ

–£ –≤—Å–µ—Ö –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–∏–ø `BaseResponse`, —Ç.–∫. –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤
–¥–∂–µ–Ω–µ—Ä–∏–∫–æ–≤—ã–π —Ç–∏–ø –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç.

–°–æ–∑–¥–∞–¥–∏–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

```ts filename="common/types/types.ts"
export const defaultResponseSchema = baseResponseSchema(z.object({}))
export type DefaultResponse = z.infer<typeof defaultResponseSchema>
```

–ü—Ä–∏–º–µ–Ω–∏–º `DefaultResponse` –¥–ª—è –º–µ—Ç–æ–¥–∞ `deleteTask`

```ts filename="tasksApi.ts" /DefaultResponse/
export const tasksApi = {
  /*...*/
  deleteTask(payload: { todolistId: string; taskId: string }) {
    const { todolistId, taskId } = payload
    return instance.delete<DefaultResponse>(`/todo-lists/${todolistId}/tasks/${taskId}`)
  },
}
```

–ò –ø—Ä–æ–ø–∏—à–µ–º `Zod` –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `thunk` –ø–æ —É–¥–∞–ª–µ–Ω–∏—é —Ç–∞—Å–∫–∏

```ts filename="tasks-slice.ts" {6}
 deleteTaskTC: create.asyncThunk(
      async (payload: { todolistId: string; taskId: string }, { dispatch, rejectWithValue }) => {
        try {
          dispatch(setAppStatusAC({ status: "loading" }))
          const res = await tasksApi.deleteTask(payload)
          defaultResponseSchema.parse(res.data) // üíé ZOD
          if (res.data.resultCode === ResultCode.Success) {
          /*...*/
          }
        } catch (error) {
          /*...*/
        }
      },
      /*...*/
    ),
```

**‚åö –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**

- –í `todolistsApi.ts` –∑–∞–º–µ–Ω–∏—Ç–µ `BaseResponse` –Ω–∞ `DefaultResponse` –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ `changeTodolistTitle` –∏ `deleteTodolist`
- –¥–æ–±–∞–≤—å—Ç–µ `Zod` –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `deleteTodolistTC` –∏ `changeTodolistTitleTC`

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–∫—Ä—ã–ª–∏ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ `Zod` –∏ –µ—Å–ª–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –Ω–∞ –±–µ–∫–µ–Ω–¥–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è, —Ç–æ –Ω–∞–º –Ω–µ —Å–æ—Å—Ç–∞–≤–∏—Ç
—Ç—Ä—É–¥–∞ —Å—Ä–∞–∑—É –∂–µ –Ω–∞–π—Ç–∏ —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ –æ–±—Å—É–¥–∏—Ç—å —Å –±–µ–∫–µ–Ω–¥–µ—Ä–æ–º üöÄ

üîó [–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç](https://github.com/safronman/zod-redux-toolkit-rtk-query/tree/f07b0af30eaf436d1ec433f7560bad80e4d011ab)
